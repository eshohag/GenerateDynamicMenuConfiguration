@using DynamicMenuMVC.AuthConfig;
@model IEnumerable<MenuConfig>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="@Url.Action("Index", "Home")">NavBar</a>
        </div>
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                @BuildMenu(Model.ToList(), 0, 0)
            </ul>
            @Html.Partial("_LoginPartial")
        </div>
        <!--/.nav-collapse -->
    </div>
</div>

@helper BuildMenu(List<MenuConfig> menus, int maxId = 0, int parentId = 0)
{
    var allMenus = menus.OrderBy(a => a.Id).ToList();
    var items = parentId > 0 ? allMenus.Where(a => a.Id >= maxId).ToList() : allMenus.ToList();

    foreach (var item in items)
    {
        if (item.IsParent == false && item.ParentId == parentId)
        {
            <li>
                <a class="" href="@Url.Action(item.Action, item.Controller)"><i class="fa @item.Icon"></i> @item.DisplayText</a>
            </li>
        }
        else
        {
            <li>
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">@item.DisplayText <b class="caret"></b></a>
                <ul class="dropdown-menu">
                    @BuildMenu(allMenus, item.Id, item.ParentId);
                </ul>
            </li>
        }
    }
}

<script src="~/Scripts/jquery-2.1.3.min.js"></script>
<script>
    $(document).ready(function () {
        $("div ul.navbar-nav>li:first").addClass("active");

        $("ul").on("click", "li", function () {
            //$("ul>li:first").removeClass("active");

            var $this = $(this);
            $this.addClass("active");

        });
    });

</script>
