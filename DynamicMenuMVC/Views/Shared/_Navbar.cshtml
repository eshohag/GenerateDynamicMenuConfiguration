@using DynamicMenuMVC.AuthConfig;
@model IEnumerable<MenuConfig>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="@Url.Action("Index", "Home")">NavBar</a>
        </div>
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                @BuildMenu(Model)
            </ul>
            @Html.Partial("_LoginPartial")
        </div>
    </div>
</div>

@helper BuildMenu(IEnumerable<MenuConfig> menus, int parentId = 0, List<MenuConfig> renderMenu = null)
{
    var renderMenus = renderMenu == null ? new List<MenuConfig>() : renderMenu;
    var allMenus = menus.OrderBy(a => a.Id).ToList();

    foreach (var item in allMenus)
    {
        if (renderMenus.FirstOrDefault(a => a.Id == item.Id) == null)
        {
            renderMenus.Add(item);
            if (item.IsParent == false && item.ParentId == parentId)
            {
                <li>
                    <a class="" href="@Url.Action(item.Action, item.Controller)"><i class="@item.Icon"></i> @item.DisplayText</a>
                </li>
            }         
            else
            {
                <li>
                    @if (item.IsParent == true && item.ParentId == parentId)
                    {
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">@item.DisplayText <b class="caret"></b></a>
                    }
                    <ul class="dropdown-menu">
                        @if (item.ParentId == parentId)
                        {
                            @BuildMenu(allMenus, item.Id, renderMenus)
                        }
                    </ul>
                </li>
            }
        }
    }
}

<script src="~/Scripts/jquery-2.1.3.min.js"></script>
<script>
    $(document).ready(function () {
        $("div ul.navbar-nav>li:first").addClass("active");

        $("ul").on("click", "li", function () {
            var $this = $(this);
            $this.addClass("active");
        });
    });

</script>
